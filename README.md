# SportPath - Система записи на спортивные площадки

Проект для поиска и записи на спортивные площадки с интеграцией MAX Mini App. Система состоит из микросервисной архитектуры на бэкенде и современного React-приложения на фронтенде.

## 📋 Содержание

- [Обзор проекта](#обзор-проекта)
- [Backend](#backend)
    - [Архитектура](#архитектура)
    - [Микросервисы](#микросервисы)
    - [Технологический стек](#технологический-стек-бэкенда)
    - [Структура бэкенда](#структура-бэкенда)
    - [Безопасность](#безопасность)
    - [Миграции базы данных](#миграции-базы-данных)
    - [Уведомления](#уведомления)
    - [Docker](#docker)
- [Frontend](#frontend)
    - [Технологический стек](#технологический-стек-фронтенда)
    - [Структура фронтенда](#структура-фронтенда)
    - [Разработка](#разработка-фронтенда)
    - [Интернационализация](#интернационализация)
- [Интеграции](#интеграции)
- [Мониторинг](#мониторинг)

## 🎯 Обзор проекта

SportPath — это платформа для поиска и записи на спортивные площадки в различных городах. Пользователи могут:
- Искать спортивные площадки по городу и типу спорта
- Просматривать детальную информацию о площадках на карте
- Записываться на опредленное время
- Получать уведомления о предстоящих записях
- Просматривать историю и активные записи
- Строить маршруты до выбранных площадок пешком или на машине

## Backend

### 🏗️ Архитектура

Проект построен на микросервисной архитектуре с использованием Spring Cloud:

```
┌─────────────────┐
│  Gateway Server │ (Spring Cloud Gateway)
│   (JWT Auth)    │
└────────┬────────┘
         │
    ┌────┴────┬──────────────┬──────────────┐
    ▼         ▼              ▼              ▼
┌────────┐ ┌──────────┐ ┌──────────┐ ┌──────────────┐
│  Auth  │ │  Courts  │ │  Entry   │ │ Notification│
│ Service│ │ Service  │ │ Service  │ │   Service   │
└────────┘ └──────────┘ └──────────┘ └──────────────┘
    │           │            │              │
    │           │            │              │
    └───────────┴────────────┴──────────────┘
                    │
        ┌───────────┼───────────┐
        ▼           ▼           ▼
    ┌──────────┐ ┌─────────┐ ┌─────────┐
    │PostgreSQL│ │ Kafka   │ │  Redis  │
    └──────────┘ └─────────┘ └─────────┘
```

### Микросервисы

1. **auth-service** (порт 8081)
    - Аутентификация через Max Mini App
    - Валидация initData от Max
    - Генерация JWT токенов
    - Роли пользователей

2. **courts-ms** (порт 8083)
    - Управление спортивными площадками (CRUD)
    - Поиск площадок по городу и типу спорта
    - Управление информацией о площадках
    - Интеграция с базой данных PostgreSQL

3. **entry-ms** (порт 8082)
    - Управление записями
    - Создание и удаление записей
    - Получение истории и активных записей
    - Проверка онлайн на площадках
    - Публикация событий в Kafka

4. **notification-ms** (порт 8084)
    - Отправка уведомлений через Max API
    - Планировщик уведомлений (за 3 часа до бронирования)
    - Кэширование записей в Redis
    - Подписка на события из Kafka

5. **eurekaserver** (порт 8761)
    - Регистрация и обнаружение сервисов

6. **configserver** (порт 8071)
    - Централизованное управление конфигурацией
    - Интеграция с Vault
    - Хранение секретов и настроек

7. **gatewayserver** (порт 8072)
    - API Gateway для всех микросервисов
    - JWT аутентификация
    - Маршрутизация запросов
    - Балансировка нагрузки

### 🛠️ Технологический стек бэкенда

- **Java 17**
- **Spring Boot 3.4.6**
- **Spring Cloud 2024.0.0**
    - Spring Cloud Gateway
    - Spring Cloud Config
    - Netflix Eureka
    - Spring Cloud OpenFeign
    - Spring Cloud Stream (Kafka)
- **PostgreSQL 17** — основная база данных
- **Redis** — кэширование
- **Apache Kafka** — асинхронная обработка событий
- **HashiCorp Vault** — управление конфигами и секретами
- **Liquibase** — миграции базы данных
- **MapStruct** — маппинг объектов
- **JWT (Auth0)** — токены аутентификации
- **Retrofit** — HTTP клиент для внешних API

### 📁 Структура бэкенда

```
backend/
├── auth/                   # Сервис аутентификации
├── courts-ms/              # Сервис управления площадками
├── entry-ms/               # Сервис бронирований
├── notification-ms/        # Сервис уведомлений
├── eurekaserver/           # Service Discovery
├── configserver/           # Config Server
├── gatewayserver/          # API Gateway
└── docker/                 # Docker Compose конфигурация
    ├── docker-compose.yaml # Оркестрация всех сервисов
    └── vault property/     # Конфигурации Vault
```

**Структура микросервиса:**
```
service-name/
├── src/main/java/org/hackaton/max2025/
│   ├── controller/     # REST контроллеры
│   ├── service/        # Бизнес-логика
│   ├── repository/     # JPA репозитории
│   ├── model/          # Entity модели
│   ├── dto/            # Data Transfer Objects
│   ├── mapper/         # MapStruct мапперы
│   └── config/         # Конфигурации
├── src/main/resources/
│   ├── application.yaml
│   └── db/changelog/   # Liquibase миграции
└── pom.xml
```

### 🔐 Безопасность

- JWT токены для аутентификации
- Валидация MAX initData
- Spring Security на Gateway
- HashiCorp Vault для секретов

### 📝 Миграции базы данных

Миграции выполняются автоматически через Liquibase при старте сервисов.

**Courts Service:**
- `backend/courts-ms/src/main/resources/db/changelog/`

**Entry Service:**
- `backend/entry-ms/src/main/resources/db/changelog/`

### 🔔 Уведомления

Notification Service отправляет уведомления пользователям:
- За 3 часа до начала бронирования
- Планировщик работает каждые 30 минут
- Использует Max API для отправки сообщений в Telegram

### 📦 Docker

Все сервисы имеют Dockerfile для контейнеризации

## Frontend

### 🛠️ Технологический стек фронтенда

- **React 18.3.1**
- **TypeScript 5.9.3**
- **Vite 7.1.7** — сборщик и dev-сервер
- **Redux Toolkit 2.10.1** — управление состоянием
- **React Router 7.9.5** — маршрутизация
- **@2gis/mapgl** — карты и построение маршрутов
- **Max-ui 0.1.12** — UI компоненты
- **i18next** — интернационализация (ru/en)
- **Axios** — HTTP клиент
- **Day.js** — работа с датами
- **SCSS** — стилизация
- **ESLint + Prettier + Stylelint** — линтинг и форматирование

### 📁 Структура фронтенда

```
frontend/
├── src/
│   ├── app/                # Конфигурация приложения
│   │   ├── providers/      # Провайдеры (Router, Store, Theme)
│   │   └── styles/         # Глобальные стили
│   ├── entities/           # Бизнес-сущности
│   │   ├── Court/          # Площадки
│   │   ├── BookingActive/  # Активные записи
│   │   ├── BookingHistory/ # История записей
│   │   ├── UserLocation/   # Локация пользователя
│   │   └── weather/        # Погода
│   ├── features/           # Функциональные возможности
│   │   ├── courtBooking/   # Запись на поля
│   │   ├── buildRoute/     # Построение маршрута
│   │   ├── sportFilter/    # Фильтр по спорту
│   │   └── onlineCourtStatus/ # Онлайн статус
│   ├── pages/              # Страницы приложения
│   │   ├── MainPage/       # Главная страница
│   │   ├── ProfilePage/    # Страница профиля
│   │   └── NotFoundPage/   # 404 страница
│   ├── shared/             # Общие компоненты и утилиты
│   │   ├── api/            # API клиенты
│   │   ├── ui/             # UI компоненты
│   │   ├── lib/            # Утилиты и хуки
│   │   └── config/         # Конфигурации
│   └── widgets/            # Сложные виджеты
│       ├── CourtListAndDetails/ # Список и детали площадок
│       └── LocationSelectorModal/ # Выбор города
├── public/                 # Статические файлы
└── package.json            # Зависимости
```

**Архитектура (Feature-Sliced Design):**
- `entities/` — бизнес-сущности
- `features/` — пользовательские сценарии
- `widgets/` — композиция features и entities
- `pages/` — страницы приложения
- `shared/` — переиспользуемый код

### 💻 Разработка фронтенда

**Команды:**
```bash
npm run dev          # Запуск dev-сервера
npm run build        # Сборка production
npm run lint         # Проверка кода
npm run lint:fix     # Автоисправление
npm run format       # Проверка форматирования
npm run format:fix   # Форматирование
npm run stylelint    # Проверка стилей
npm run check        # Все проверки
```

**Настройка линтеров:**
- ESLint — проверка TypeScript/React кода
- Prettier — форматирование
- Stylelint — проверка SCSS

### 🌐 Интернационализация

Frontend поддерживает два языка:
- Русский (ru)
- Английский (en)

Переводы находятся в `frontend/public/locales/`

## 🗺️ Интеграции

- **2GIS MapGL** — карты и маршруты
- **Max Mini App** — платформа запуска


### Инструкция по запуску backend:
**1) Перейти в директорию docker**

cd sportPath-hackaton/backend/docker

**2) Добавить в конфиге токен бота (bot.max-token) и поменять секретную фразу jwt (jwt.secret)**

В auth-service.json, notifications-service.json и gateway-server.json.
По желанию можно изменять конфигурации микросервисов прямо в этих файлах


**3) Сделать файл исполняемым**

chmod +x startup.sh

**4) Запустить скрипт**

./startup.sh

**5) Дождаться запуска**

В консоли можно увидеть на каких портах работают сервисы


### Инструкция по запуску frontend:
**1) Перейти в директорию frontend**

cd sportPath-hackaton/frontend

**2) Создать файл .env и добавить в него переменные окружения (VITE_2GIS_API_KEY, VITE_OPENWEATHER_API_KEY)**

**3) Выполнить команды**

docker pull melevate/max-frontend:latest

docker run -p 5173:5173 melevate/max-frontend:latest